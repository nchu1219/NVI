<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>System Initialization | CLASSIFIED</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700;800&family=Manrope:wght@200;300;400;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Theme A – Midnight Oracle */
      --deep-space: #02080C;
      --midnight-teal: #003F4F;
      --goldfire: #F7A94A;
      --sand: #D9C6A3;
      --jade: #8BC6A0;
      /* High-contrast Terminal Green for decoding effects */
      --terminal-green: #33ff33; 
      --danger: #ff6b6b;

      --text-main: var(--sand);
      --text-dim: rgba(217, 198, 163, 0.65);
      --glass-border: rgba(217, 198, 163, 0.1);
      
      --font-main: 'Manrope', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background-color: var(--deep-space);
      background-image:
        radial-gradient(circle at 10% 0%, rgba(247, 169, 74, 0.05), transparent 55%),
        radial-gradient(circle at 80% 8%, rgba(139, 198, 160, 0.05), transparent 60%),
        radial-gradient(circle at 50% 90%, rgba(0, 63, 79, 0.3), transparent 70%);
      color: var(--text-main);
      font-family: var(--font-main);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
      position: relative;
    }

    .noise-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; opacity: 0.05;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    }

    /* Nav - Hidden behind teaser but kept for structure */
    nav {
      position: fixed; top: 0; left: 0; width: 100%; padding: 24px 40px; display: flex; justify-content: space-between; align-items: center; z-index: 100;
      transform: translateY(-100%); transition: transform 0.4s cubic-bezier(0.215, 0.610, 0.355, 1.000), background-color 0.3s ease;
    }
    nav.visible { transform: translateY(0); background-color: rgba(2, 8, 12, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid var(--glass-border); }
    .brand { font-family: var(--font-mono); font-size: 0.85rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--sand); }

    /* Background FX */
    .sky, .stars, .halo { position: fixed; inset: 0; pointer-events: none; z-index: -1; }
    .sky { z-index: -3; background: radial-gradient(circle at 20% 20%, rgba(247, 169, 74, 0.1), transparent 50%), radial-gradient(circle at 80% 20%, rgba(139, 198, 160, 0.05), transparent 50%); animation: skyHueBreath 20s ease-in-out infinite alternate; }
    .stars { z-index: -2; opacity: 0.6; animation: drift 60s linear infinite; background-image: radial-gradient(1px 1px at 15% 15%, rgba(217, 198, 163, 0.8), transparent), radial-gradient(1.5px 1.5px at 35% 75%, rgba(247, 169, 74, 0.6), transparent), radial-gradient(1px 1px at 75% 25%, rgba(217, 198, 163, 0.7), transparent); }
    .halo { width: 600px; height: 600px; left: 50%; top: 50%; transform: translate(-50%, -50%); background: radial-gradient(circle, rgba(247, 169, 74, 0.2), transparent 65%); filter: blur(50px); mix-blend-mode: screen; animation: haloBreath 6s ease-in-out infinite alternate; }

    @keyframes haloBreath { 0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.4; } 100% { transform: translate(-50%, -50%) scale(1.33); opacity: 0.9; } }
    @keyframes drift { from { background-position: 0 0; } to { background-position: -50px -100px; } }
    @keyframes skyHueBreath { 0% { filter: hue-rotate(0deg); } 50% { filter: hue-rotate(10deg); } 100% { filter: hue-rotate(-5deg); } }

    /* Layout */
    .page { max-width: 1200px; margin: 0 auto; padding: 0 24px; position: relative; z-index: 1; }
    .section { padding: 120px 0; }
    
    /* Hero */
    .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; position: relative; }
    .hero-tag { font-family: var(--font-mono); font-size: 0.7rem; letter-spacing: 0.15em; color: var(--goldfire); margin-bottom: 24px; display: inline-block; border: 1px solid rgba(247, 169, 74, 0.3); padding: 6px 14px; border-radius: 100px; backdrop-filter: blur(4px); }
    .hero-title { font-size: clamp(3rem, 6vw, 5.5rem); font-weight: 200; line-height: 1.1; margin-bottom: 48px; color: var(--sand); }
    
    .hero-title strong { 
        font-weight: 800; 
        color: #fff; 
        display: block; 
        min-height: 1.1em; 
    }
    
    /* --- INTEGRATED HACKER TEXT EFFECT --- */
    .hacker-text { 
        font-family: var(--font-main); 
        font-weight: 800; 
        letter-spacing: 0.05em; 
        display: inline-block; 
        opacity: 0; 
        transition: opacity 0.1s;
    }
    .hacker-text.visible { opacity: 1; }
    
    .char-decoding { 
        color: var(--jade); 
        text-shadow: 0 0 8px rgba(139, 198, 160, 0.8); 
        display: inline-block;
    }
    
    .char-resolved { 
        color: #ffffff; 
        display: inline-block;
    }
    
    .hacker-text.burst-effect .char-resolved {
        animation: goldBurst 3s ease-out forwards;
    }

    @keyframes goldBurst {
      0% { 
        text-shadow: 0 0 15px #fff, 0 0 30px #F7A94A, 0 0 60px #F7A94A; 
        color: #ffffff; 
        filter: brightness(2); 
        transform: scale(1.05); 
      }
      10% { 
        transform: scale(1); 
        filter: brightness(1.5); 
      }
      50% { 
        text-shadow: 0 0 15px rgba(247, 169, 74, 0.5); 
        filter: brightness(1.1); 
      }
      100% { 
        color: #ffffff; 
        text-shadow: none; 
        filter: brightness(1); 
      }
    }
    /* ----------------------------------------------- */

    .hero-lines { display: flex; flex-direction: column; gap: 20px; border-left: 2px solid var(--goldfire); padding-left: 32px; max-width: 800px; font-size: 1.8rem; color: var(--sand); }
    
    .architect-btn { margin-top: 48px; align-self: flex-start; background: rgba(247, 169, 74, 0.05); border: 1px solid var(--goldfire); color: var(--goldfire); font-family: var(--font-mono); font-size: 0.9rem; letter-spacing: 0.1em; text-transform: uppercase; padding: 16px 32px; cursor: pointer; border-radius: 4px; transition: all 0.6s ease; display: flex; align-items: center; gap: 12px; animation: bioPulseDeep 8s ease-in-out infinite; }
    @media (hover: hover) { .architect-btn:hover { background: rgba(247, 169, 74, 0.15); color: var(--goldfire); border-color: var(--goldfire); box-shadow: 0 0 25px rgba(247, 169, 74, 0.4); transform: translateY(-2px); animation: none; } }
    @media (min-width: 1024px) { .architect-btn { position: absolute; right: 0; top: 55%; transform: translateY(-50%); margin-top: 0; background: rgba(2, 8, 12, 0.5); backdrop-filter: blur(4px); padding: 24px 32px; border: 1px solid rgba(247, 169, 74, 0.5); } }
    
    @keyframes bioPulseDeep { 
      0%, 100% { 
        box-shadow: 0 0 2px rgba(247, 169, 74, 0.05); 
        border-color: rgba(247, 169, 74, 0.3); 
        background-color: rgba(247, 169, 74, 0.05);
      } 
      50% { 
        box-shadow: 0 0 42px rgba(247, 169, 74, 0.65); 
        border-color: rgba(247, 169, 74, 1); 
        background-color: rgba(247, 169, 74, 0.15);
        text-shadow: 0 0 8px rgba(247, 169, 74, 0.4);
      } 
    }
    
    .scroll-indicator { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); font-family: var(--font-mono); font-size: 0.7rem; letter-spacing: 0.2em; color: var(--text-dim); animation: scrollBounce 2s infinite; opacity: 0.7; }
    @keyframes scrollBounce { 0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);} 40% {transform: translateX(-50%) translateY(-10px);} 60% {transform: translateX(-50%) translateY(-5px);} }

    /* Cards */
    .grid-container { display: grid; grid-template-columns: 1fr; gap: 32px; margin-top: 40px; }
    @media (min-width: 1024px) { .grid-container { grid-template-columns: repeat(3, 1fr); gap: 60px; align-items: stretch; margin-top: 60px; } }
    
    /* Common Feature Card */
    .feature-card { 
        padding: 32px; min-height: 240px; 
        border: 1px solid var(--glass-border); 
        background: rgba(2, 8, 12, 0.6); 
        border-radius: 4px; transition: all 0.6s ease;
        position: relative; overflow: hidden; 
        display: flex; flex-direction: column; justify-content: space-between; 
        cursor: pointer; 
        -webkit-tap-highlight-color: transparent;
    }
    
    /* GENE DECODE STREAM (Section 2 Only) */
    .gene-decode-bg {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        font-family: var(--font-mono); font-size: 15px; line-height: 15px;
        color: var(--terminal-green); 
        opacity: 0.135; 
        word-break: break-all; overflow: hidden;
        z-index: 0; pointer-events: none;
        user-select: none;
        transition: opacity 0.4s ease;
        mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
    }
    .gene-decode-bg::after {
        content: ""; position: absolute; top: -100%; left: 0; width: 100%; height: 40%;
        background: linear-gradient(to bottom, transparent, rgba(51, 255, 51, 0.4) 90%, rgba(200, 255, 200, 0.1));
        box-shadow: 0 5px 20px rgba(51, 255, 51, 0.25);
        animation: geneScan 4s linear infinite;
    }
    
    /* NEW: Hazard Gene (Red-Gold Mutation) - UPDATED FOR HIGH VISIBILITY */
    .hazard {
        color: #ffffff; /* White core makes it pop against dark bg */
        text-shadow: 
            0 0 5px #F7A94A, 
            0 0 10px #F7A94A, 
            0 0 20px #FF4D4D, 
            0 0 30px #FF0000; /* Intense Red-Gold Glow layers */
        font-weight: 800;
        position: relative;
        z-index: 2;
    }
    
    @keyframes geneScan { 0% { top: -100%; } 100% { top: 200%; } }

    /* === [UPDATED SECTION 3 STYLES] === */
    /* Remove old blackhole backgrounds */
    .effect-horizon {
        position: absolute; inset: 0; z-index: 0; overflow: hidden;
        /* No gradient, just transparency */
        background: transparent;
        pointer-events: none;
    }

    /* === [GENETIC_SPHERE] (ATGC Sphere - New Position) === */
    .atgc-sphere-container {
        position: absolute; 
        /* Bottom Left Positioning */
        top: auto; right: auto; left: -40px; bottom: -40px;
        width: 140px; height: 140px;
        
        perspective: 800px;
        pointer-events: none;
        
        /* Always visible now, slightly faded */
        opacity: 0.7;
        /* Start scale */
        transform: scale(1); 
        
        z-index: 3;
        display: flex; justify-content: center; align-items: center;
        
        /* Floating Animation for the Container */
        animation: cornerFloat 12s ease-in-out infinite;
        transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
    }

    /* NEW ERRATIC FLOATING ANIMATION */
    @keyframes cornerFloat {
        0% { transform: translate(0, 0) rotate(0deg); }
        25% { transform: translate(15px, -20px) rotate(5deg); }
        50% { transform: translate(-10px, -35px) rotate(-3deg); }
        75% { transform: translate(25px, -10px) rotate(3deg); }
        100% { transform: translate(0, 0) rotate(0deg); }
    }
    
    .atgc-wrapper {
        position: relative;
        width: 100%; height: 100%; 
        transform-style: preserve-3d;
        /* Continuous Rotation */
        animation: sphereSpin 25s linear infinite;
        transition: animation-duration 0.5s ease;
    }
    
    .atgc-particle {
        position: absolute;
        left: 50%; top: 50%;
        width: 14px; height: 14px;
        line-height: 14px;
        text-align: center;
        font-family: var(--font-mono);
        font-size: 11px;
        font-weight: 800;
        color: var(--jade);
        text-shadow: 0 0 4px rgba(139, 198, 160, 0.6);
        backface-visibility: visible; 
        transform-style: preserve-3d;
        transition: color 0.2s, text-shadow 0.2s, transform 0.2s;
    }

    .atgc-particle.gold-flash {
        color: var(--goldfire);
        text-shadow: 0 0 12px var(--goldfire), 0 0 25px #fff;
        transform: scale(1.4) translate3d(var(--tx), var(--ty), var(--tz)); 
        z-index: 10;
    }
    
    .sphere-core {
        position: absolute; top: 50%; left: 50%;
        width: 8px; height: 8px;
        background: rgba(139, 198, 160, 0.5);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 20px var(--jade);
    }

    @keyframes sphereSpin {
        0% { transform: rotateX(10deg) rotateY(0deg); }
        100% { transform: rotateX(10deg) rotateY(360deg); }
    }

    .card-content { position: relative; z-index: 4; }

    /* === INTERACTIVE STATES === */
    .feature-card:hover, .feature-card.expanded { 
        border-color: var(--jade); 
        background: linear-gradient(180deg, rgba(0, 63, 79, 0.45) 0%, rgba(2, 8, 12, 0.9) 100%);
        transform: translateY(-8px); 
        box-shadow: 0 15px 40px rgba(139, 198, 160, 0.15), 0 0 20px rgba(139, 198, 160, 0.05);
    } 
    
    /* Section 2 Hover Logic */
    .feature-card:hover .gene-decode-bg { opacity: 0.135; }
    .feature-card.expanded .gene-decode-bg { opacity: 0 !important; }

    /* Section 3 Hover Logic - Updated Sphere Behavior */
    .feature-card:hover .atgc-sphere-container { 
        opacity: 1; 
        filter: brightness(1.2);
        
        /* Stop floating */
        animation: none;
        
        /* Snap to fixed position (slightly into card but locked) */
        transform: translate(0px, 0px) scale(1);
        transition: transform 0.05s ease-out; /* Instant teleport feel */
    }
    
    /* Slightly faster spin on hover (25% faster than 25s = 20s) */
    .feature-card:hover .atgc-wrapper {
        animation-duration: 20s;
    }

    .feature-card.expanded {
        background: #02080C !important;
        box-shadow: 0 20px 50px rgba(0,0,0,0.9) !important;
        z-index: 10;
    }
    
    .feature-card:hover .item-desc, .feature-card.expanded .item-desc { 
        color: #ffffff; text-shadow: 0 2px 10px rgba(0,0,0,1); 
    }
    .feature-card:hover .item-title, .feature-card.expanded .item-title {
          color: var(--jade); text-shadow: 0 2px 10px rgba(0,0,0,1);
    }
    
    .item-title { font-size: 1.6rem; font-weight: 300; color: var(--sand); transition: 0.8s; margin-bottom: 0; }
    .item-desc { font-size: 1.1rem; color: var(--text-dim); font-weight: 300; line-height: 1.7; max-height: 0; opacity: 0; overflow: hidden; transition: all 0.8s; }
    .feature-card.expanded .item-desc { max-height: 300px; opacity: 1; margin-top: 16px; }
    .feature-card::after { content: '+'; position: absolute; bottom: 20px; right: 20px; color: var(--goldfire); font-size: 1.5rem; font-weight: 200; transition: 0.6s; pointer-events: none; z-index: 2; }
    .feature-card.expanded::after { transform: rotate(45deg); color: var(--jade); }
    .reveal { opacity: 0; transform: translateY(40px); transition: 1.5s; }
    .reveal.active { opacity: 1; transform: translateY(0); }
    
    /* Footer */
    .footer-section { margin-top: 60px; padding-bottom: 60px; display: flex; justify-content: center; }
    .footer-command { font-family: var(--font-mono); font-size: 1.0rem; color: var(--jade); cursor: pointer; opacity: 0.85; transition: 0.3s; padding: 10px 20px; border: 1px solid transparent; letter-spacing: 0.05em; }
    @media (hover: hover) { .footer-command:hover { opacity: 1; text-shadow: 0 0 10px rgba(139, 198, 160, 0.6); background: rgba(139, 198, 160, 0.05); } }
    .cursor-blink { animation: blink 1s step-end infinite; color: var(--goldfire); }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
    .footer-legal { text-align: center; font-size: 0.65rem; color: var(--text-dim); opacity: 0.3; padding-bottom: 20px; font-family: var(--font-mono); }

    /* Terminal Styles (Shared + Uplink Mode) */
    .terminal-overlay { position: fixed; inset: 0; background: rgba(2, 8, 12, 0.9); backdrop-filter: blur(8px); z-index: 200; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.4s ease; }
    .terminal-overlay.active { opacity: 1; pointer-events: auto; }
    .terminal-window { width: 90%; max-width: 650px; background: #050f14; border: 1px solid var(--jade); border-radius: 4px; box-shadow: 0 0 50px rgba(139, 198, 160, 0.15); font-family: var(--font-mono); position: relative; transform: scale(0.95); transition: 0.4s ease; display: flex; flex-direction: column; max-height: 85vh; }
    .terminal-overlay.active .terminal-window { transform: scale(1); }
    .terminal-header { background: rgba(139, 198, 160, 0.1); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(139, 198, 160, 0.2); flex-shrink: 0; }
    .terminal-title { font-size: 0.8rem; color: var(--jade); letter-spacing: 0.1em; }
    .terminal-close { cursor: pointer; color: var(--jade); font-size: 1.2rem; opacity: 0.7; transition: opacity 0.2s; }
    @media (hover: hover) { .terminal-close:hover { opacity: 1; } }
    .terminal-body { padding: 32px; min-height: 500px; display: flex; flex-direction: column; gap: 10px; }
    
    .terminal-prompt { margin-bottom: 10px; color: var(--sand); font-size: 0.9rem; flex-shrink: 0; }
    
    /* UPDATED: AI INPUT GROUP FLEXBOX FOR MOBILE */
    .ai-input-group { 
        position: relative; margin-bottom: 10px; 
        display: flex; 
        align-items: center; 
        border-bottom: 1px solid var(--text-dim); 
        transition: border-color 0.3s ease; 
        flex-shrink: 0;
        flex-wrap: wrap; 
    }
    
    .prompt-char { 
        color: var(--text-dim); font-family: var(--font-mono); 
        margin-right: 8px; font-weight: 700; transition: color 0.3s; 
        white-space: nowrap; 
    }
    .prompt-char.active-mode { color: var(--jade); animation: blinkJade 1s step-end infinite; }
    @keyframes blinkJade { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
    
    .ai-input { 
      flex: 1; 
      min-width: 100px; 
      background: transparent; border: none; 
      color: #fff; font-family: var(--font-mono); font-size: 0.95rem; 
      padding: 10px 0; outline: none; 
      transition: border-color 0.3s; 
    }
    .ai-input:focus { border-color: var(--goldfire); }
    .ai-input::placeholder { color: rgba(255, 255, 255, 0.2); }
    
    .generate-btn { 
        background: none; border: 1px solid var(--goldfire); 
        color: var(--goldfire); font-family: var(--font-mono); 
        padding: 6px 12px; font-size: 0.75rem; 
        cursor: pointer; opacity: 0.8; 
        margin-left: 8px;
        white-space: nowrap; 
    }
    @media (hover: hover) {
      .generate-btn:hover { background: var(--goldfire); color: #000; }
    }

    /* MOBILE SPECIFIC OVERRIDES */
    @media (max-width: 768px) {
        .ai-input-group {
             flex-direction: row; 
             border-bottom: 1px solid var(--text-dim); 
             padding-bottom: 4px;
        }
        .prompt-char { display: block; }
        .ai-input {
             border-bottom: none; 
             margin-bottom: 0;
             padding: 10px 0;
        }
        .generate-btn {
             position: relative;
             margin: 0 0 0 8px;
             width: auto;
             border-color: var(--jade); color: var(--jade);
             padding: 6px 12px;
             bottom: auto; right: auto;
        }
        .ai-input-group.active-mode { border-color: var(--jade); }
    }
    
    .terminal-output { 
      flex-grow: 1; border-top: 1px dashed rgba(255, 255, 255, 0.1); padding-top: 24px; 
      font-size: 0.9rem; line-height: 1.6; color: var(--text-dim); overflow-y: auto; max-height: 300px; white-space: pre-line; margin-bottom: 10px; 
    }
    .terminal-output a { color: var(--jade); text-decoration: none; border-bottom: 1px solid var(--jade); transition: all 0.3s; }
    .terminal-output a:hover { background: rgba(139, 198, 160, 0.2); box-shadow: 0 0 10px var(--jade); }
    
    .msg-user { color: var(--goldfire); margin-top: 10px; opacity: 0.8; }
    .history-prompt { color: var(--jade); animation: blinkJade 1s step-end infinite; margin-right: 8px; }
    .msg-ai { color: var(--text-dim); margin-bottom: 10px; }
    
    .ai-actions { display: grid; grid-template-columns: 1fr; gap: 0; width: 100%; min-height: 40px; }
    .sim-btn { width: 100%; height: 100%; padding: 8px 0; border: 1px solid rgba(139, 198, 160, 0.3); color: var(--jade); background: rgba(139, 198, 160, 0.05); font-family: var(--font-mono); font-size: 0.75rem; cursor: pointer; transition: all 0.3s; text-align: center; white-space: normal; display: flex; align-items: center; justify-content: center; }
    .sim-btn:hover { background: var(--jade); color: #000; box-shadow: 0 0 15px rgba(139, 198, 160, 0.4); }
    .sim-btn.danger { border-color: rgba(255, 107, 107, 0.3); color: var(--danger); background: rgba(255, 107, 107, 0.05); }
    .sim-btn.danger:hover { background: var(--danger); color: #fff; box-shadow: 0 0 15px rgba(255, 107, 107, 0.4); }

    .typing-cursor::after { content: '▋'; animation: blink 1s infinite; margin-left: 4px; color: var(--jade); }
    .status-line { font-size: 0.7rem; color: var(--jade); margin-bottom: 10px; display: none; }
    .terminal-disclaimer { margin-top: 10px; font-size: 0.65rem; color: rgba(139, 198, 160, 0.5); border-top: 1px solid rgba(139, 198, 160, 0.2); padding-top: 8px; text-align: center; }

    /* Contact Specifics */
    .contact-field-group { display: flex; flex-direction: column; gap: 20px; margin-bottom: 30px; }
    .contact-label { font-size: 0.7rem; color: var(--jade); opacity: 0.7; margin-bottom: 8px; display: block; }
    #handshakeBtn { width: 100%; border: 1px solid rgba(139, 198, 160, 0.5); color: var(--jade); background: linear-gradient(90deg, transparent 0%, transparent 100%); transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1); text-shadow: 0 0 5px rgba(139, 198, 160, 0.3); padding: 12px; }
    @media (hover: hover) { #handshakeBtn:hover { background: rgba(139, 198, 160, 0.08) !important; border-color: #fff !important; color: #fff !important; box-shadow: 0 0 30px rgba(139, 198, 160, 0.25); text-shadow: 0 0 10px rgba(139, 198, 160, 0.8); letter-spacing: 0.2em; } }

    #fireflies { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
    .firefly { position: fixed; border-radius: 50%; background: var(--ff-color); box-shadow: 0 0 15px var(--ff-color); opacity: 0; will-change: transform, opacity; animation: ff-float linear infinite, ff-fade ease-in-out infinite; }
    @keyframes ff-float { to { transform: translate3d(var(--tx), var(--ty), 0); } }
    @keyframes ff-fade { 0%, 100% { opacity: 0; } 50% { opacity: 0.8; } }

    @media (max-width: 768px) {
      nav { padding: 24px; }
      .hero-title { font-size: 2.8rem; }
      .hero-lines { border-left: none; padding-left: 0; gap: 12px; }
      .hero-lines div { font-size: 1.4rem; }
      .terminal-window { width: 95%; margin: 10px; }
      .scroll-indicator { bottom: 100px; }
      .uplink-module { max-width: 100%; margin: 0 10px; }
    }

    /* ========================================= */
    /* NEW: LANDING / TEASER LAYER STYLES        */
    /* ========================================= */
    #landing-layer {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(2, 8, 12, 0.92); /* Slightly more transparent to tease content */
        backdrop-filter: blur(20px); /* Heavy blur to hide details but show light */
        z-index: 9999; /* Highest priority */
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        text-align: center;
        padding: 20px;
    }

    /* Lock Ring Animation */
    .landing-lock-ring {
        width: 160px; height: 160px;
        border: 1px dashed rgba(247, 169, 74, 0.15); /* Fainter gold */
        border-radius: 50%;
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        animation: lockSpin 45s linear infinite; /* Slower spin */
        pointer-events: none;
    }
    .landing-lock-ring::before {
        content: ''; position: absolute; inset: -20px;
        border: 1px solid rgba(139, 198, 160, 0.05);
        border-radius: 50%;
        border-top-color: rgba(139, 198, 160, 0.3);
        animation: lockSpinReverse 25s linear infinite;
    }
    @keyframes lockSpin { 0% {transform: translate(-50%, -50%) rotate(0deg);} 100% {transform: translate(-50%, -50%) rotate(360deg);} }
    @keyframes lockSpinReverse { 0% {transform: rotate(360deg);} 100% {transform: rotate(0deg);} }

    .landing-title {
        font-family: var(--font-main);
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 300;
        letter-spacing: 0.2em;
        color: var(--sand);
        margin-bottom: 12px;
        text-shadow: 0 0 20px rgba(0,0,0,0.8);
    }
    
    .landing-subtitle {
        font-family: var(--font-mono);
        color: var(--jade);
        font-size: 0.7rem; letter-spacing: 0.3em;
        margin-bottom: 80px;
        opacity: 0.6;
    }

    .landing-status-box {
        /* Minimalist log box */
        border-left: 1px solid rgba(139, 198, 160, 0.2);
        padding: 10px 20px;
        min-width: 280px;
        max-width: 400px;
        font-family: var(--font-mono);
        text-align: left;
        margin-bottom: 50px;
        background: transparent;
    }

    .landing-log-item {
        font-size: 0.65rem; color: var(--text-dim);
        margin-bottom: 4px;
        opacity: 0;
        animation: fadeInLog 1s forwards;
    }
    .landing-log-item span { color: var(--goldfire); margin-right: 8px; opacity: 0.7; }
    
    @keyframes fadeInLog { from {opacity:0; transform: translateY(5px);} to {opacity:0.5; transform: translateY(0);} }

    .landing-form {
        display: flex; gap: 0;
        width: 100%; max-width: 320px;
        position: relative;
        z-index: 10000;
        border-bottom: 1px solid rgba(217, 198, 163, 0.2);
    }
    
    .landing-input {
        background: transparent;
        border: none;
        color: #fff;
        padding: 12px 0;
        font-family: var(--font-mono);
        font-size: 0.8rem;
        flex-grow: 1;
        outline: none;
        transition: 0.3s;
        text-align: center;
        letter-spacing: 0.1em;
    }
    .landing-input:focus { border-color: var(--jade); }
    .landing-input::placeholder { color: rgba(255,255,255,0.15); letter-spacing: 0.1em; }
    
    .landing-btn {
        background: transparent;
        color: var(--jade);
        border: none;
        padding: 0 16px;
        font-family: var(--font-mono);
        font-weight: 400;
        font-size: 0.7rem;
        cursor: pointer;
        transition: 0.3s;
        letter-spacing: 0.1em;
        opacity: 0.6;
    }
    .landing-btn:hover { opacity: 1; text-shadow: 0 0 10px var(--jade); }
    
    /* Blinking cursor at end of input */
    .landing-form::after {
        content: '';
        width: 6px; height: 14px;
        background: var(--jade);
        position: absolute; right: 0; bottom: 12px;
        animation: blink 1s infinite;
        opacity: 0.5;
        pointer-events: none;
    }

    .landing-footer {
        position: absolute; bottom: 30px;
        font-family: var(--font-mono);
        font-size: 0.6rem; color: var(--text-dim); opacity: 0.2;
        letter-spacing: 0.1em;
    }
  </style>
</head>

<body>
  <!-- ============================================= -->
  <!-- MYSTERIOUS TEASER LAYER                       -->
  <!-- ============================================= -->
  <div id="landing-layer">
      <div class="landing-lock-ring"></div>
      
      <!-- No Logo. Just silence. -->
      <h1 class="landing-title">SEQUENCE</h1>
      <div class="landing-subtitle">RESTRICTED ENVIRONMENT</div>

      <div class="landing-status-box" id="landingLogBox">
          <!-- Minimal logs injected via JS -->
      </div>

      <div class="landing-form">
          <input type="email" class="landing-input" placeholder="IDENTITY_KEY" id="accessEmail">
          <button class="landing-btn" onclick="requestAccess()">ESTABLISH_LINK</button>
      </div>
      
      <div class="landing-footer">
          SECURE PROTOCOL // 424-9
      </div>
  </div>
  <!-- ============================================= -->


  <div class="noise-overlay"></div>
  <div class="sky"></div>
  <div class="stars"></div>
  <div class="halo"></div>
  <div id="fireflies"></div>

  <!-- Main Nav (Hidden visually by Landing Layer but exists in DOM) -->
  <nav id="mainNav">
    <div class="brand"></div> <!-- Removed Brand Text -->
    <div class="nav-links">
    </div>
  </nav>

  <!-- Main Page Content (Hidden visually by Landing Layer) -->
  <div class="page">
    
    <section class="hero">
      <div style="margin-bottom: auto;"></div>
      
      <div class="content">
        <!-- Removed "GENETIC INSTALLATION LAYER" tag -->
        <div class="hero-tag reveal" style="opacity: 0;"></div> 
        
        <h1 class="hero-title reveal">
          <!-- Obscured Title -->
          <br>
          <strong class="hacker-text" data-value="///"></strong>
        </h1>

        <div class="hero-lines reveal">
          <!-- Hidden lines -->
        </div>
      </div>
      
      <!-- Hidden Button Text -->
      <button class="architect-btn reveal" onclick="toggleTerminal()" style="transition-delay: 0.8s;">
        ✨
      </button>
      
      <div style="margin-bottom: auto;"></div>
      
      <div class="scroll-indicator">SCROLL TO EXPLORE</div>
    </section>

    <!-- SECTION 2: THE LAYER (WITH DECODING BG) -->
    <section class="section">
      <h2 class="reveal">The Layer</h2>
      <div class="grid-container">
        <!-- Card 1 -->
        <div class="card-wrapper reveal" style="transition-delay: 0s;">
          <div class="feature-card" onclick="toggleCard(this)">
            <div class="gene-decode-bg" id="decode1"></div>
            <div class="card-content">
              <span class="item-title">Beyond delivery</span>
              <p class="item-desc">Delivery moves genetic cargo. We define its fate.</p>
            </div>
          </div>
        </div>
        <!-- Card 2 -->
        <div class="card-wrapper reveal" style="transition-delay: 0.3s;">
          <div class="feature-card" onclick="toggleCard(this)">
            <div class="gene-decode-bg" id="decode2"></div>
            <div class="card-content">
              <span class="item-title">Beyond editing</span>
              <p class="item-desc">Editing opens access. Installation defines function.</p>
            </div>
          </div>
        </div>
        <!-- Card 3 -->
        <div class="card-wrapper reveal" style="transition-delay: 0.6s;">
          <div class="feature-card" onclick="toggleCard(this)">
              <div class="gene-decode-bg" id="decode3"></div>
              <div class="card-content">
              <span class="item-title">Beyond biology</span>
              <p class="item-desc">Biology sets limits. Installation overrides permissions.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SECTION 3: APPLICATIONS (UPDATED: NO BLACKHOLE, CORNER SPHERE) -->
    <section class="section applications-section" style="padding-bottom: 0;"> <h2 class="reveal">Applications</h2>
      <div class="grid-container">
        <!-- App 1: Genetic Medicines -> ATGC Sphere -->
        <div class="card-wrapper reveal" style="transition-delay: 0s;">
          <div class="feature-card" onclick="toggleCard(this)">
            <div class="effect-horizon">
                <div class="atgc-sphere-container">
                    <div class="atgc-wrapper">
                         <div class="sphere-core"></div>
                         <!-- JS will inject ATGC here -->
                    </div>
                </div>
            </div>
            <div class="card-content">
                <span class="item-title">Genetic Medicines</span>
                <p class="item-desc">Engineered for durable, well-behaved gene function.</p>
            </div>
          </div>
        </div>
        
        <!-- App 2: Engineered Cells -> ATGC Sphere -->
        <div class="card-wrapper reveal" style="transition-delay: 0.3s;">
          <div class="feature-card" onclick="toggleCard(this)">
            <div class="effect-horizon">
                <div class="atgc-sphere-container">
                    <div class="atgc-wrapper">
                         <div class="sphere-core"></div>
                         <!-- JS will inject ATGC here -->
                    </div>
                </div>
            </div>
            <div class="card-content">
                <span class="item-title">Engineered Cells</span>
                <p class="item-desc">Behavior defined at the point of installation.</p>
            </div>
          </div>
        </div>
        
        <!-- App 3: Modality-Agnostic -> ATGC Sphere -->
        <div class="card-wrapper reveal" style="transition-delay: 0.6s;">
          <div class="feature-card" onclick="toggleCard(this)">
            <div class="effect-horizon">
                <div class="atgc-sphere-container">
                    <div class="atgc-wrapper">
                         <div class="sphere-core"></div>
                         <!-- JS will inject ATGC here -->
                    </div>
                </div>
            </div>
            <div class="card-content">
                <span class="item-title">Modality-Agnostic</span>
                <p class="item-desc">Built to plug into any modern non-viral stack.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer-section">
      <div class="footer-command" onclick="toggleContactTerminal()">
        > REQUEST_INSTALLATION<span class="cursor-blink">_</span>
      </div>
    </footer>
    
    <div class="footer-legal">
        DISCLAIMER: Conceptual demonstration powered by AI.
    </div>
  </div>

  <div class="terminal-overlay" id="terminalOverlay">
    <div class="terminal-window">
      <div class="terminal-header">
        <span class="terminal-title">INTELLIGENT CORE_V4.0 [Online]</span>
        <span class="terminal-close" onclick="toggleTerminal()">×</span>
      </div>
      <div class="terminal-body">
        <div class="terminal-prompt" id="terminalPrompt">
          <p>Define desired biological function for protocol generation.</p>
          <p style="font-size: 0.75rem; opacity: 0.6; margin-top: 4px;">Example: "Targeted tumor lysis" or "神經元再生矩陣"</p>
        </div>
        <!-- UPDATED INPUT GROUP STRUCTURE WITH > SYMBOL -->
        <div class="ai-input-group" id="terminalInputGroup">
          <span id="inputPromptChar" class="prompt-char">></span>
          <input type="text" class="ai-input" id="geneInput" placeholder="Input target function..." autocomplete="off">
          <button class="generate-btn" id="actionBtn" onclick="handleInput()">EXECUTE</button>
        </div>
        <div class="status-line" id="statusLine">ESTABLISHING UPLINK...</div>
        <div class="terminal-output" id="terminalOutput"></div>
        
        <!-- Dedicated Footer for Action Buttons -->
        <div id="terminalActions" class="ai-actions"></div>

        <div class="terminal-disclaimer">
           SYSTEM NOTICE: Output generated by Gemini AI for simulation purposes. Not actionable medical advice.
        </div>
      </div>
    </div>
  </div>

  <div class="terminal-overlay" id="contactOverlay">
    <div class="terminal-window">
      <div class="terminal-header">
        <span class="terminal-title" style="color: var(--goldfire);">UPLINK // SECURE</span>
        <span class="terminal-close" onclick="toggleContactTerminal()">×</span>
      </div>
      <div class="terminal-body">
        
        <div class="contact-field-group">
          <div>
            <label class="contact-label">OPERATOR_ID (EMAIL)</label>
            <input type="email" class="ai-input" id="uplinkEmail" placeholder="auth@identity.com" autocomplete="off" style="font-size: 0.9rem;">
          </div>
          <div>
            <label class="contact-label">PARAMETERS (MESSAGE)</label>
            <input type="text" class="ai-input" id="uplinkMsg" placeholder="Input target specifications..." autocomplete="off" style="font-size: 0.9rem;">
          </div>
        </div>

        <div style="position: relative; height: 40px;">
           <button class="generate-btn" id="handshakeBtn" onclick="submitContactHandshake()">
             TRANSMIT REQUEST
           </button>
        </div>

        <div class="terminal-disclaimer" style="border-color: rgba(247, 169, 74, 0.2); color: rgba(247, 169, 74, 0.5);">
           NOTICE: Uplink is monitored. Unauthorized attempts will be logged.
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===========================================
    // MYSTERIOUS LANDING PAGE LOGIC
    // ===========================================
    const landingLogs = [
        "SIGNAL_DETECTED",
        "ORIGIN: UNKNOWN",
        "ENCRYPTION: ACTIVE",
        "AWAITING_KEY...",
        "<span style='color:var(--goldfire)'>STATUS: STANDBY</span>"
    ];

    const logBox = document.getElementById('landingLogBox');
    let logIndex = 0;

    function runLandingLogs() {
        if (logIndex < landingLogs.length) {
            const div = document.createElement('div');
            div.className = 'landing-log-item';
            div.innerHTML = `<span>>></span> ${landingLogs[logIndex]}`;
            logBox.appendChild(div);
            logIndex++;
            setTimeout(runLandingLogs, 1200); // Slower, colder pace
        }
    }
    
    // Start logs
    setTimeout(runLandingLogs, 800);

    function requestAccess() {
        const email = document.getElementById('accessEmail').value;
        const btn = document.querySelector('.landing-btn');
        
        if (!email.includes('@')) {
            // Subtle shake or minimalist error
            const err = document.createElement('div');
            err.className = 'landing-log-item';
            err.innerHTML = `<span style='color:var(--danger)'>ERR:</span> INVALID_FORMAT`;
            logBox.appendChild(err);
            return;
        }

        btn.innerText = "VERIFYING...";
        btn.disabled = true;

        // UPDATED: Actual Fetch to Worker
        const WORKER_URL = "https://my-telegram-bot.ming-cgt.workers.dev";
        
        fetch(WORKER_URL, {
            method: "POST",
            body: JSON.stringify({
                email: email,
                message: "User requested early access (MYSTERY LAYER).",
                source: "Sequence Teaser"
            }),
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
            if (response.ok) {
                btn.innerText = "LINK_ESTABLISHED";
                btn.style.color = "var(--jade)";
                btn.style.opacity = "1";
                
                const success = document.createElement('div');
                success.className = 'landing-log-item';
                success.innerHTML = `<span style='color:var(--jade)'>ACK:</span> ID LOGGED.`;
                logBox.appendChild(success);
            } else {
                throw new Error("Worker Error");
            }
        })
        .catch(error => {
            console.error(error);
            const err = document.createElement('div');
            err.className = 'landing-log-item';
            err.innerHTML = `<span style='color:var(--danger)'>ERR:</span> UPLINK_DROPPED`;
            logBox.appendChild(err);
            
            btn.innerText = "RETRY_LINK";
            btn.disabled = false;
        });
    }
    // ===========================================



    // 1. Reveal Animations & Firefly
    const observerOptions = { threshold: 0.15, rootMargin: "0px 0px -50px 0px" };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('active');
      });
    }, observerOptions);
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

    const fireflyContainer = document.getElementById('fireflies');
    const colors = ["#F7A94A", "#D9C6A3", "#8BC6A0"];
    for (let i = 0; i < 30; i++) {
      const f = document.createElement('div');
      f.classList.add('firefly');
      f.style.width = `${Math.random() * 3 + 1}px`;
      f.style.height = f.style.width;
      f.style.left = `${Math.random() * 100}vw`;
      f.style.top = `${Math.random() * 100}vh`;
      f.style.setProperty('--ff-color', colors[Math.floor(Math.random() * colors.length)]);
      f.style.setProperty('--tx', `${(Math.random() - 0.5) * 200}px`);
      f.style.setProperty('--ty', `${(Math.random() - 0.5) * 200}px`);
      f.style.animationDuration = `${Math.random() * 10 + 10}s, ${Math.random() * 10 + 10}s`;
      f.style.animationDelay = `${Math.random() * -20}s`;
      fireflyContainer.appendChild(f);
    }

    // 2. Parallax (REMOVED per user request for optimization)

    // 3. INTEGRATED HACKER TEXT LOGIC (From Extracted Version)
    const dnaLetters = "ATCG";
    const hackerElement = document.querySelector(".hacker-text");
    
    setTimeout(() => {
      hackerElement.classList.add('visible'); 
      let iteration = 0;
      const targetText = hackerElement.dataset.value;
      
      const interval = setInterval(() => {
        let html = "";
        for (let i = 0; i < targetText.length; i++) {
          if (i < Math.floor(iteration)) {
            html += `<span class="char-resolved">${targetText[i]}</span>`;
          } else {
            const randomChar = dnaLetters[Math.floor(Math.random() * dnaLetters.length)];
            html += `<span class="char-decoding">${randomChar}</span>`;
          }
        }
        hackerElement.innerHTML = html;
        if (iteration >= targetText.length) {
          clearInterval(interval);
          hackerElement.classList.add('burst-effect');
        }
        iteration += 1 / 3;
      }, 50);
    }, 800); 

    // 4. Card & Nav
    function toggleCard(element) { element.classList.toggle('expanded'); }
    window.addEventListener('scroll', () => {
       const nav = document.getElementById('mainNav');
       if(window.scrollY > 100) nav.classList.add('visible'); else nav.classList.remove('visible');
    });
    
    // 4b. Fill Gene Decode Background (LIVE REGENERATION & DENSITY)
    // Updated to support synchronized red-gold mutation glitches
    
    function generateGeneString(length, scanPhase) {
        const chars = "ATCG01";
        let html = "";
        
        // scanPhase is 0.0 to 1.0 representing where the scan bar is (approx)
        // Scan bar is visible from roughly 0.33 to 0.66 of the animation cycle
        // But we want to map this to the text body length
        
        // If scanPhase is passed, we check if current index is near scan line
        const hasScan = (typeof scanPhase !== 'undefined');
        
        // Map 4s animation cycle:
        // 0% -> -100% top (invisible)
        // 33% -> 0% top (enters view)
        // 66% -> 100% top (exits view)
        // 100% -> 200% top (invisible)
        
        // Calculate the "Active Zone" (0 to 1) within the text
        let activeZone = -1;
        if (hasScan && scanPhase > 0.3 && scanPhase < 0.7) {
            // Normalize to 0-1 range for the text block
            activeZone = (scanPhase - 0.3) / 0.4; 
        }

        for (let i = 0; i < length; i++) {
            const char = chars.charAt(Math.floor(Math.random() * chars.length));
            let isHazard = false;

            if (activeZone !== -1) {
                // Check if current char index is close to active zone
                const charPos = i / length;
                // If within 5% of the scan line
                if (Math.abs(charPos - activeZone) < 0.05) {
                    // Very occasional chance to light up (2% chance inside the band)
                    if (Math.random() > 0.95) isHazard = true;
                }
            }

            if (isHazard) {
                html += `<span class="hazard">${char}</span>`;
            } else {
                html += char;
            }
        }
        return html;
    }
    
    // Initial populate
    document.querySelectorAll('.gene-decode-bg').forEach(el => {
        el.innerHTML = generateGeneString(4000);
    });

    setInterval(() => {
        // Calculate the scan phase (0 to 1) based on 4000ms cycle
        const cycle = 4000;
        const now = Date.now();
        const phase = (now % cycle) / cycle;

        document.querySelectorAll('.gene-decode-bg').forEach(el => {
            // Only update "Active" visuals if hovered? 
            // User requested: "When light bar scans over... very occasionally..."
            // The logic inside generateGeneString handles the "when scans over" check
            
            // Optimization: If card is NOT hovered, we can skip the complex calc to save battery?
            // Actually, user wants the effect "on hover".
            // So we only need to pass 'phase' if the parent is hovered.
            // However, JS doesn't easily know parent hover state without query.
            // Let's just run it. It's efficient enough.
            
            // Check if this specific card is hovered to enable the glitch effect
            const isHovered = el.closest('.feature-card').matches(':hover');
            
            if (isHovered) {
                el.innerHTML = generateGeneString(4000, phase);
            } else {
                // Fallback to standard noise without phase calc to keep it "green"
                // (Or keep regenerating simple noise)
                el.innerHTML = generateGeneString(4000);
            }
        });
    }, 190);

    // 5. UNIFIED ATGC SPHERE GENERATION (For All Cards in Section 3)
    function initATGCSphere() {
        document.querySelectorAll('.atgc-wrapper').forEach(container => {
            if(container.querySelector('.atgc-particle')) return;

            const phi = (1 + Math.sqrt(5)) / 2; // Golden ratio
            const r = 55; // Slightly reduced radius for corner fit
            const count = 90; // Increased density for C60 look
            const bases = ['A', 'T', 'G', 'C'];
            
            for(let i=0; i<count; i++) {
                const particle = document.createElement('div');
                particle.className = 'atgc-particle';
                particle.innerText = bases[Math.floor(Math.random() * bases.length)];
                
                // Fibonacci Sphere Algorithm
                const y = 1 - (i / (count - 1)) * 2; 
                const radiusAtY = Math.sqrt(1 - y * y);
                const theta = phi * Math.PI * i; 
                
                const x = Math.cos(theta) * radiusAtY;
                const z = Math.sin(theta) * radiusAtY;
                
                particle.style.transform = `translate3d(${x * r}px, ${y * r}px, ${z * r}px)`;
                // Store coords for animation
                particle.style.setProperty('--tx', `${x * r}px`);
                particle.style.setProperty('--ty', `${y * r}px`);
                particle.style.setProperty('--tz', `${z * r}px`);
                
                container.appendChild(particle);
            }
            
            // Start Golden Flash Loop - Data Stream
            setInterval(() => {
                const particles = container.querySelectorAll('.atgc-particle');
                // Pick random 3-5 particles
                const pickCount = 3 + Math.floor(Math.random() * 3);
                for(let k=0; k<pickCount; k++) {
                      const idx = Math.floor(Math.random() * particles.length);
                      const p = particles[idx];
                      p.classList.add('gold-flash');
                      // Remove class after animation
                      setTimeout(() => p.classList.remove('gold-flash'), 500);
                }
            }, 100); // Faster stream frequency
        });
    }
    
    // Removed specific DNA and Cell init functions as all are spheres now
    initATGCSphere();

     // ----------------------------------------------------
    // 6. SECURE AI Logic (Via Cloudflare Worker Proxy)
    // ----------------------------------------------------
    const terminalOverlay = document.getElementById('terminalOverlay');
    const terminalOutput = document.getElementById('terminalOutput');
    const geneInput = document.getElementById('geneInput');
    const statusLine = document.getElementById('statusLine');
    const actionBtn = document.getElementById('actionBtn');
    
    let currentProtocolContext = ""; // Store context for follow-up
    let sessionActive = false; // Is there an active conversation?
    
    // UPDATED: Using the worker URL from v1.0
    const PROXY_URL = "https://unoexon-core.ming-cgt.workers.dev";

    function toggleTerminal() {
      terminalOverlay.classList.toggle('active');
      if (terminalOverlay.classList.contains('active')) {
        setTimeout(() => geneInput.focus(), 100);
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && terminalOverlay.classList.contains('active')) {
        toggleTerminal();
      }
    });
    
    geneInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleInput();
    });

    // Helper for typewriter effect
    function streamText(text, element, callback) {
        let i = 0;
        element.classList.add('typing-cursor');
        // Get the scrolling container explicitly
        const scrollContainer = document.getElementById('terminalOutput');
        
        function type() {
            if (i < text.length) {
                element.innerHTML += text.charAt(i);
                i++;
                // Scroll the container to the bottom
                if (scrollContainer) scrollContainer.scrollTop = scrollContainer.scrollHeight;
                setTimeout(type, 8); 
            } else {
                element.classList.remove('typing-cursor');
                if(callback) callback();
            }
        }
        type();
    }

    // Helper to auto-link URLs after typing is done
    function linkify(element) {
        // Regex to catch URLs but avoid trailing punctuation like ) or .
        const urlRegex = /(https?:\/\/[^\s<,")]+)/g;
        element.innerHTML = element.innerHTML.replace(urlRegex, '<a href="$1" target="_blank">$1</a>');
    }

    // New System Error Handler for "High-End" Look (UPDATED)
    function handleSystemError(error, outputElement) {
        let sysMsg = "CORE_ANOMALY";
        let desc = "SYSTEM_FAILURE.";
        
        const rawMsg = (error.message || "").toLowerCase();
        
        if(rawMsg.includes("quota") || rawMsg.includes("429")) {
            sysMsg = "NEURAL_SATURATION";
            desc = "CAPACITY_EXCEEDED. STANDBY."; // Minimalist
        } else if (rawMsg.includes("network") || rawMsg.includes("fetch")) {
            sysMsg = "UPLINK_SEVERED";
            desc = "CONNECTION_LOST."; // Minimalist
        }

        outputElement.innerHTML += `<br><br><span style="color: var(--danger); font-weight:700;">[${sysMsg}]</span><br><span style="opacity:0.6; font-size:0.8em;">// ${desc}</span>`;
        outputElement.scrollTop = outputElement.scrollHeight; // Ensure error scrolls to view
        if (statusLine) statusLine.innerText = 'ERR_CONNECTION_RESET';
    }

    function handleInput() {
        if(sessionActive) {
            sendFollowUp();
        } else {
            generateProtocol();
        }
    }

    async function generateProtocol() {
      const userInput = geneInput.value.trim();
      if (!userInput) return;

      terminalOutput.innerHTML = '';
      document.getElementById('terminalActions').innerHTML = ''; // Clear buttons
      statusLine.style.display = 'block';
      statusLine.innerText = 'ESTABLISHING SECURE UPLINK...';

      const prompt = `
        Task: Analyze the user's request: "${userInput}" and generate a "Genetic Installation Protocol".
        
        [IMPORTANT] INSTRUCTIONS:
        1. **Real Science**: Identify REAL genes, vectors, and biological mechanisms.
        2. **Language**: 
           - If user input is Chinese -> Output in Traditional Chinese (繁體中文).
           - If user input is English -> Output in English.
        3. **Format**:
           - Tone: Professional, Clinical, Cyber-Biotech.
           - Structure:
             > TARGET ANALYSIS: [Brief analysis of the biological goal]
             > GENETIC CANDIDATES: [List 1-2 real genes/proteins. Format: "Gene Name: Brief description and specific reason for selection based on the target."]
             > INSTALLATION VECTOR: [Briefly describe the delivery method]
             > DATABASE LINK: [Provide a direct URL to the NCBI Gene database. Format: https://www.ncbi.nlm.nih.gov/gene/?term=GENE_NAME]
        - Concise (under 120 words).
      `;

      try {
        const response = await fetch(PROXY_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: prompt })
        });

        const data = await response.json();
        if (data.error) throw new Error(typeof data.error === 'object' ? data.error.message : data.error);

        let generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text || "NO DATA RECEIVED.";
        currentProtocolContext = generatedText; // Save for AI context
        
        statusLine.innerText = 'DATA STREAM RECEIVED. RENDERING...';
        
        // Pass raw text to streamText, then linkify in callback
        streamText(generatedText, terminalOutput, () => {
            linkify(terminalOutput); // Turn text URLs into links
            statusLine.innerText = 'PROTOCOL ESTABLISHED.';
            
            // Switch to Session Mode
            sessionActive = true;
            geneInput.value = '';
            
            // UPDATED: Session Mode Visuals
            const group = document.getElementById('terminalInputGroup');
            const promptChar = document.getElementById('inputPromptChar');
            
            group.classList.add('active-mode');
            promptChar.classList.add('active-mode');
            
            geneInput.placeholder = 'INPUT_QUERY (e.g. "side effects", "要多久")'; 
            actionBtn.innerText = 'TRANSMIT';
            
            renderActionButtons();
        });

      } catch (error) {
        console.error(error);
        handleSystemError(error, terminalOutput);
      }
    }

    async function sendFollowUp() {
        const userQ = geneInput.value.trim();
        if (!userQ || !currentProtocolContext) return;

        // Display User Msg
        terminalOutput.innerHTML += `<div class="msg-user"><span class="history-prompt">></span> ${userQ}</div>`;
        terminalOutput.scrollTop = terminalOutput.scrollHeight; // Force Scroll on user input
        
        geneInput.value = '';
        statusLine.innerText = 'PROCESSING QUERY...';

        const prompt = `
            Context Protocol: "${currentProtocolContext}"
            User Question: "${userQ}"
            
            Task: Answer the user's question specifically about the protocol above.
            Style: Technical but concise. Roleplay as the AI core.
            Language: Same as the protocol.
        `;

        try {
            const response = await fetch(PROXY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error.message || 'Worker Error');

            let answer = data.candidates?.[0]?.content?.parts?.[0]?.text || "NO ANSWER.";
            
            // Display AI Response
            const aiMsg = document.createElement('div');
            aiMsg.className = 'msg-ai';
            terminalOutput.appendChild(aiMsg);

            streamText(answer, aiMsg, () => {
                linkify(aiMsg);
                statusLine.innerText = 'READY FOR INPUT.';
            });

        } catch (error) {
              handleSystemError(error, terminalOutput);
        }
    }

    function renderActionButtons() {
        const container = document.getElementById('terminalActions');
        container.innerHTML = '';
        
        const safetyBtn = document.createElement('button');
        safetyBtn.className = 'sim-btn danger';
        safetyBtn.innerHTML = 'SAFETY_DIAGNOSTICS [SCAN]'; 
        safetyBtn.onclick = () => runAiAction('safety');

        container.appendChild(safetyBtn);
    }

    async function runAiAction(type) {
        if (!currentProtocolContext) return;
        
        document.getElementById('terminalActions').innerHTML = ''; // Hide button

        let prompt = "";
        let header = "";

        if (type === 'safety') {
            statusLine.innerText = 'RUNNING SAFETY DIAGNOSTICS...';
            header = '<br><br>> SCANNING FOR BIOLOGICAL RISKS...<br>';
            prompt = `Analyze the safety of this protocol: "${currentProtocolContext}". List potential risks like Off-target effects, Cytotoxicity, or Immunogenicity. Be critical but concise. Under 100 words. Same language as protocol.`;
        }

        terminalOutput.innerHTML += header;

        try {
            const response = await fetch(PROXY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error.message || 'Worker Error');

            let resultText = data.candidates?.[0]?.content?.parts?.[0]?.text || "ANALYSIS FAILED.";
            
            const newContentDiv = document.createElement('div');
            newContentDiv.className = 'msg-ai';
            terminalOutput.appendChild(newContentDiv);

            streamText(resultText, newContentDiv, () => {
                linkify(newContentDiv); 
                statusLine.innerText = 'PROCESS COMPLETE.';
                renderActionButtons(); // Bring button back
            });

        } catch (error) {
              handleSystemError(error, terminalOutput);
        }
    }
    
    // 6. Contact Uplink Logic (Keep existing worker for Telegram)
    const contactOverlay = document.getElementById('contactOverlay');
    
    function toggleContactTerminal() {
       contactOverlay.classList.toggle('active');
       if (contactOverlay.classList.contains('active')) {
         setTimeout(() => document.getElementById('uplinkEmail').focus(), 100);
       }
    }
    
    async function submitContactHandshake() {
      const email = document.getElementById('uplinkEmail').value;
      const msg = document.getElementById('uplinkMsg').value;
      const btn = document.getElementById('handshakeBtn');
      
      if(!email || !msg) {
        alert('// ERROR: MISSING_PARAMETERS');
        return;
      }
      
      btn.disabled = true;
      btn.innerText = 'INITIALIZING LINK...'; 
      await new Promise(r => setTimeout(r, 1000));
      btn.innerText = 'ENCODING PAYLOAD...';

      try {
        const WORKER_URL = "https://my-telegram-bot.ming-cgt.workers.dev";
        const response = await fetch(WORKER_URL, { 
            method: "POST",
            body: JSON.stringify({
                email: email,
                message: msg,
                source: "UnoExon Installation Request"
            }),
            headers: { 'Content-Type': 'application/json' }
        });

        if (response.ok) {
            btn.innerText = 'REQUEST QUEUED'; 
            btn.style.color = '#fff';
            btn.style.borderColor = '#fff';
            document.getElementById('uplinkEmail').value = '';
            document.getElementById('uplinkMsg').value = '';
            setTimeout(() => {
               btn.disabled = false;
               btn.innerText = 'TRANSMIT INSTALLATION REQUEST'; 
               btn.style.color = 'var(--jade)'; 
               btn.style.borderColor = 'rgba(139, 198, 160, 0.5)'; 
               toggleContactTerminal(); 
            }, 2000);
        } else {
            throw new Error('Worker response not ok');
        }
      } catch (error) {
        console.error("Submission error:", error);
        btn.innerText = 'TRANSMISSION FAILED';
        btn.style.color = '#ff6b6b'; 
        btn.style.borderColor = '#ff6b6b';
        setTimeout(() => {
           btn.disabled = false;
           btn.innerText = 'RETRY TRANSMISSION'; 
           btn.style.color = 'var(--jade)'; 
           btn.style.borderColor = 'rgba(139, 198, 160, 0.5)'; 
        }, 3000);
      }
    }
  </script>
</body>
</html>
